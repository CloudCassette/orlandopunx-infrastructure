name: 🎸 Sync Will's Pub Events

on:
  schedule:
    - cron: '0 9,15,21 * * *'  # Run 3 times daily: 9am, 3pm, 9pm EST
  workflow_dispatch: # Allow manual triggering

jobs:
  sync-events:
    runs-on: self-hosted
    name: 📅 Sync Events from Will's Pub
    
    steps:
    - name: 🔄 Checkout Repository
      uses: actions/checkout@v4
      
    - name: 🎯 Enhanced Event Scraping with Flyers
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      run: |
        cd scripts/event-sync
        
        # Activate virtual environment
        source venv/bin/activate
        
        # Run the enhanced scraper
        echo "🎸 Running enhanced Will's Pub scraper..."
        python3 enhanced_willspub_sync.py
        
        # Show what was downloaded
        echo "📊 Sync Results:"
        echo "==============="
        if [ -f sync_summary.txt ]; then
          cat sync_summary.txt
        fi
        
        echo ""
        echo "🖼️ Flyers Downloaded:"
        ls -la flyers/ 2>/dev/null || echo "No flyers directory yet"
        
        # Archive results
        mkdir -p ../../backups/willspub-events
        cp willspub_events.* ../../backups/willspub-events/willspub_events_$(date +%Y%m%d_%H%M).* 2>/dev/null || true
        
        if [ -d flyers ] && [ "$(ls -A flyers)" ]; then
          cp -r flyers ../../backups/willspub-flyers/flyers_$(date +%Y%m%d_%H%M)/ 2>/dev/null || true
        fi
        
        echo "✅ Enhanced event scraping completed"
        
  # Remove the separate notify job since enhanced scraper posts to Discord directly
